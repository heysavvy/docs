---
title: "How To: Use Stripe Coupons and Promo Codes"
description: "How to implement and apply Stripe coupons and promo codes in your Embeddable"
---

Stripe offers two ways to provide discounts to your customers: Coupons and Promo Codes. While they're related, they serve different purposes and are implemented differently.

## Understanding Coupons vs Promo Codes

### Coupons
- Coupons are the underlying discount rules you create in Stripe.
- They define the actual discount (e.g., 20% off, $10 off, etc).
- They are not customer-facing and are identified by IDs in Stripe, that can either look like `A1b2C3d4` or an ID chosen by you.
- You can create coupons in your [Stripe Dashboard](https://dashboard.stripe.com/coupons).

### Promo Codes
- Promo codes are customer-facing codes that are linked to coupons.
- They are what customers actually enter to get a discount.
- They have a customer-friendly format (e.g., "BLACKFRIDAY50"), and they also have a unique ID generated by Stripe that looks like `promo_1A2B3C4D5E6F7G8H9I0J`.
- You can create promo codes [in your Stripe Dashboard from within a Coupon](https://dashboard.stripe.com/promotion_codes).

<Note>
  Both coupons and promo codes are environment-specific - they exist either in test mode or live mode in Stripe, but not both.
  
  Make sure you're using the correct mode for your Embeddable. If you want to test coupons or promo codes in both modes, you'll need to create equivalent coupons and promo codes in both modes.
</Note>

## Implementing Promo Codes in Your Embeddable

There are two ways to implement promo codes in your Embeddable:

### 1. Manual Entry by Customer

To let customers enter their own promo codes:

<Steps>
  <Step title="Add Input and Button Components">
    - Add a Container component to house your promo code components.
    - Add a 2nd Container component to display the input and button components side-by-side.
    - Add an Input Box component for use to enter the promo code, with a key such as `new_promo_code`.
    - Add a Button component for the user to click to submit the code.
    - Add 2 Plain Text components to display success + error messages, giving them the content of `{{promo_code_success_message}}` and `{{promo_code_error_message}}` respectively.
  </Step>

  <Step title="Style the components">
    - Style the inner Container to use Flex to display the input and button components side-by-side, and consider giving it a max-width.
    - Style the input box to be a varying width, based on the width of the container.
    - Style the success message to be green, and the error message to be red.
  </Step>

  <Step title="Create an Action">
    Create an Action that will be triggered when the button is clicked:

    ```javascript
    function output(userData, { setUserData }) {
      // Get the promo code from the input, using its key
      const promoCode = userData.new_promo_code;
      
      // Apply the promo code using the Stripe Checkout function
      window.StripeCheckout.applyPromotionCode(promoCode)
        .then((result) => {
          if (result.type === 'success') {
            // On success:
            // - Update the success message to show the applied discount
            // - Clear any error message
            // - Reset the input box to empty
            setUserData({
              promo_code_success_message: `Promo code "${promoCode}" applied successfully!`,
              promo_code_error_message: "",
              new_promo_code: "",
            });
          } else {
            // Handle error case
            setUserData({
              promo_code_success_message: "",
              promo_code_error_message: result.error.message || "Invalid promo code",
            });
          }
        })
        .catch((error) => {
          // Handle any unexpected errors
          setUserData({
            promo_code_success_message: "",
            promo_code_error_message: "An unexpected error occurred",
          });
        });
    }
    ```
  </Step>

  <Step title="Register User Data Keys">
    - In your Embeddable settings, add the following keys to the "Registered Keys" section:
      - `promo_code_success_message`
      - `promo_code_error_message`
    - This ensures these keys are properly tracked and managed by the Embeddables reactive engine.
  </Step>

  <Step title="Add a Trigger to the Action">
    - Add a Trigger to the Action that fires when the button is clicked.
  </Step>

  <Step title="Recommended: Reset Messages on Page Load">
    Since the Stripe checkout session is refreshed when the user refreshes or changes pages, you'll want to reset the success and error messages when the page loads, to avoid the user thinking that their promo code is still applied.
    
    - Create a new Action to reset the success and error messages when the page loads.

    ```javascript
    function output(userData, { setUserData }) {
      setUserData({
        promo_code_success_message: "",
        promo_code_error_message: "",
      });
    }
    ```

    - Add a Trigger to this Action that fires on page load.
    - This ensures the messages are cleared when the Stripe checkout session is refreshed.
  </Step>
</Steps>

### 2. Automatic Application

Use this method to automatically apply a discount for all customers. You can configure this directly in the builder UI.

#### Using the Builder UI

<Steps>
  <Step title="Navigate to Discount Settings">
    - Select your Stripe Checkout component in the builder.
    - In the Options panel on the right, scroll to the **Checkout session** section.
    - Find the **Discount** section.
  </Step>

  <Step title="Choose Your Discount Type">
    You have two options for applying discounts:

    **Option 1: Static Discount (Promo Code or Coupon)**
    - Toggle off "Use template discounts" (if it's enabled).
    - Choose between **Promo code** or **Coupon** using the tabs.
    - Enter your Stripe promo code ID (e.g., `promo_1MiM6KLkdIwHu7ixrIaX4wgn`) or coupon ID (e.g., `jMT0WJUD`).
    
    <Note>
      You can only use either a promo code OR a coupon, not both. Stripe currently only supports one discount per checkout session.
    </Note>

    **Option 2: Dynamic Discount (Using Templating)**
    - Toggle on "Use template discounts".
    - Enter a template variable in the **Discounts template** field (e.g., `{{my_discounts}}`).
    - This allows you to dynamically set the discount based on user data, computed fields, or actions.
  </Step>
</Steps>

#### Understanding Templating

Templating allows you to dynamically apply discounts based on runtime data. This is useful when:
- Different users should receive different discounts.
- The discount is calculated based on user behavior or data.
- You want to A/B test different discount strategies.

**How Templating Works:**

When you enable "Use template discounts", the engine replaces your template variable with the actual discount data at runtime. The template variable should resolve to an array containing a discount object:

```javascript
// Example: Setting discount via a Computed Field
function output(userData) {
  // Return an array with a single discount object
  return [
    {
      promotion_code: "promo_1MiM6KLkdIwHu7ixrIaX4wgn"  // OR
      // coupon: "jMT0WJUD"
    }
  ];
}
```

You can set the discount data using:
- **Computed Fields**: Calculate the discount based on user data.
- **Actions**: Set the discount dynamically based on user interactions.
- **URL Parameters**: Pass discount codes via URL parameters.

**Example: Dynamic Discount Based on User Type**

```javascript
// Computed Field: calculate_discount
function output(userData) {
  const userType = userData.user_type;
  
  if (userType === "vip") {
    return [{ coupon: "VIP_DISCOUNT_50" }];
  } else if (userType === "new_customer") {
    return [{ promotion_code: "promo_WELCOME20" }];
  }
  
  // No discount for regular users
  return [];
}
```

Then in your Stripe component, set the **Discounts template** field to: `{{calculate_discount}}`

<Warning>
  When using templating, ensure your template variable resolves to a valid array format. The engine expects an array containing discount objects with either a `promotion_code` or `coupon` field.
</Warning>

#### Replacing the Entire Checkout Session with Templating

For advanced use cases, you can replace the entire checkout session configuration using templating. This is useful when you need complete control over all checkout session parameters.

**How to Enable:**

In the Stripe component Options:
1. Scroll to the **Checkout session** section.
2. Look for the **Enable template checkout session** option (or similar toggle).
3. When enabled, you can provide a template variable that resolves to a complete Stripe checkout session object.

This allows you to:
- Dynamically set line items, discounts, metadata, and all other checkout session parameters.
- Create different checkout experiences for different user segments.
- Calculate complex pricing logic in a Computed Field or Action.

**Example:**

```javascript
// Computed Field: dynamic_checkout_session
function output(userData) {
  return {
    mode: "payment",
    currency: "usd",
    line_items: [
      {
        price_data: {
          currency: "usd",
          product_data: {
            name: userData.product_name || "Default Product"
          },
          unit_amount: userData.calculated_price || 1000
        },
        quantity: 1
      }
    ],
    discounts: userData.has_discount ? [{ coupon: "SPECIAL_OFFER" }] : []
  };
}
```

<Warning>
  When using automatic application, make sure you're using the correct promo code or coupon for your environment (test vs live mode).
</Warning>

## Troubleshooting

<AccordionGroup>
  <Accordion title="Error: Invalid promo code">
    This usually means one of the following:
    - The promo code doesn't exist in your Stripe account.
    - You're using a test mode promo code in live mode (or vice versa).
    - The promo code has expired or been deactivated.
    - The promo code doesn't apply to the current products in the cart.
    - You're using the wrong type of value, out of the 3 options (promo code ID, coupon ID, or customer-facing promo code) - [read about the differences above](#understanding-coupons-vs-promo-codes).
  </Accordion>

  <Accordion title="Error: Promo code already applied">
    This means the customer has already applied a promo code to their checkout session. Only one promo code can be applied at a time.
  </Accordion>

  <Accordion title="Error: Coupon ID instead of Promo Code">
    If you're getting errors when trying to apply a discount, make sure you're using a promo code (customer-facing code) and not a coupon ID. The `applyPromotionCode` function expects a promo code, not a coupon ID.
  </Accordion>
</AccordionGroup>

## Best Practices

1. **Test Both Modes**: Always test your promo codes in both test and live modes to ensure they work as expected.

2. **Clear Messaging**: Make sure your UI clearly communicates:
   - Where to enter the promo code.
   - When a code has been successfully applied.
   - When a code is invalid and why.
   - That only one promo code can be applied at a time.

3. **Error Handling**: Implement proper error handling in your Action to provide a good user experience when:
   - The code is invalid.
   - The code has expired.
   - The code doesn't apply to the current products.
   - The code has already been applied.

4. **Security**: Remember that promo codes are public-facing. Don't include sensitive information in them, and consider implementing rate limiting if you're concerned about brute force attempts.

5. **Data Management**: 
   - Register all user data keys in your Embeddable settings to ensure proper tracking and management.
   - Reset success/error messages on page load to handle Stripe checkout session refreshes.
   - Keep your user data structure clean by clearing input fields after successful code application. 